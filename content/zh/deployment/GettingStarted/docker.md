---
title: "Docker 部署 FoundryVTT 教程"
linkTitle: "Docker 部署教程"
weight: 21
type: docs
---

Foundry VTT 目前拥有若干个来自不同用户实现的 Dockerfile，这些实现中，较为推荐 [felddy/foundryvtt](https://github.com/felddy/foundryvtt-docker) 的镜像，而使用该教程中提供的 Linux 自动部署脚本，可以简化操作，自动部署，无需学习 Docker 的使用和管理。

## 介绍

目前可以通过中文社区的自动脚本进行容器化部署，也可以手动启动容器。

在全新购买的云服务器上使用自动脚本进行部署，最少只需要输入 Foundry VTT 站点上的用户名和密码即可完成，同时脚本也包含了后续更新、维护的方法。

### 使用 Docker 的优点
- 无需关心系统环境：只要是主流发行版的 Linux，甚至于 Windows 服务器，只要安装了 Docker，即和其他用户的部署行为一致，难以因系统环境问题出错
- 直接使用 Docker 的后台管理：Docker 自己会监控容器内运行的进程状态、网站可访问状态，如果意外情况导致 FVTT 崩溃或无法访问，可以不需要使用 pm2 等进程监控工具即可自动重启、还原
- 目前主流的 FVTT 的 Docker 镜像包含内置的自动获取下载地址和授权的脚本，可以简化部署流程
- ...

### 使用 Docker 的缺点
- Docker 本身需要安装，同时拉取镜像、容器本身都消耗了一定冗余的存储空间（但不超过 100M）
- 如果使用卷挂载，直接访问 FVTT 的数据文件会变得略困难（可以通过 Docker 启动其他容器简化文件访问，以下自动部署脚本已使用 Web 文件管理器解决该问题）
- 目前主流的 FVTT 的 Docker 镜像升级时需要重建容器，而不能通过 FVTT 内置更新（以下自动部署脚本可以大幅简化更新流程）
- ...

## 安装流程

### 自动部署脚本（中文社区） 使用教程
1. 首先，假设已经登入了 Linux 服务器，并且能够获得 root 权限
2. 下载脚本
    ```bash
    wget -O fvtt.sh https://gitee.com/mitchx7/FoundryDeploy/raw/master/fvtt.sh && sudo chmod +x fvtt.sh
    ```
3. 运行脚本，进行安装
    ```bash
    sudo ./fvtt.sh
    ```
    > 安装时会检查是否能获取 root 权限，并且如果没有安装 Docker 会自动安装 Docker
    > 
    > 境内服务器下载镜像时会等待较长时间，可以耐心等待，或者使用星界投影镜像

    然后脚本会提示输入参数，每条参数输入完成后回车即可，参数包含（✅：必需 | ⭕：可选）：
    ![](/images/deployment/docker-script-input.png)
    - ✅ FVTT 账号
    - ✅ FVTT 密码 （用于获取 FVTT 下载地址/授权信息）
    - ⭕ 版本号/下载地址
        - 直接回车跳过输入版本号，使用最新稳定版即可
        - **注意**：如果使用境内服务器，从 FVTT 官方下载安装包会比较慢，可以考虑粘贴[星界投影](../../../modules/#如何使用国内镜像解决系统和-mod-难以安装的问题)的镜像下载源的 Linux 版本下载链接。**境内服务器强烈推荐使用镜像**！
        - Linux 版 FVTT 的星界投影的镜像下载地址为：`https://cdn.sbea.in/foundry/linux/foundryvtt-0.7.5.zip`。如果需要使用其他版本，替换链接中的 `0.7.5` 即可
        - ✅ 如果跳过了 FVTT 账号/密码的输入，则必须输入直链下载地址而非版本号来安装
    - ⭕ 自定义管理密码
        - 安装完成后，如果设置了这个密码，需要使用密码才能管理 FVTT，强烈推荐进行设置；回车跳过就不设置密码
    - ⭕ FVTT 绑定域名
        - 如果为这台服务器绑定了给 FVTT 使用的域名，可以输入域名（不带 HTTP/HTTPS），否则直接回车跳过
        - 绑定域名的流程可参见[绑定（子）域名](../domain-name/#绑定子域名)
    - ⭕ FVTT CDN 加速域名
        - 如果想要使用 CDN，可以配置一个 CDN 加速域名，详情参见 [CDN 配置](../cdn)章节，否则直接回车跳过
    - ⭕ 使用 Web 文件管理器
        - 为了管理文件方便，建议使用。直接回车跳过设置，默认会使用；如果不使用输入`n`再回车
    - ⭕ 如果使用 Web 文件管理器，可以绑定域名
        - 如果需要给 Web 文件管理器绑定域名进行使用，可以输入，否则直接回车跳过
    - ⭕ 使用 Docker 仪表盘
        - Docker 仪表盘用来方便的管理服务器上运行的容器（重启、监测状态等），比如 FVTT 和 Web 文件管理器等；默认不会使用，可以直接回车跳过
    - ⭕ 如果使用 Docker 仪表盘，可以绑定域名
        - 如果需要给 Docker 仪表盘绑定域名进行使用，可以输入，否则直接回车跳过

    确认输入好的参数之后，便可以回车等待部署完成

4. 部署完成后，脚本会提示如何访问 FVTT，如图所示：
![](/images/deployment/docker-script-result.png)

> 如上图所示的部署完毕后，如果还是不能访问 FVTT，请参见 FAQ 中的[无法连接](../../../tutorial/faq#为什么显示安装成功后仍然无法连接-foundryvtt)的问题

{{% alert title="Tips" color="info" %}}
自动部署脚本其他使用方法和详情，请参见[脚本仓库](https://github.com/fvtt-cn/FoundryDeploy)中的文档
{{% /alert %}}

{{% alert title="注意" color="warning" %}}
如果多次提示部署失败，可以使用 `sudo ./fvtt.sh clear` 接着输入两次 `y` 和回车以确认，清空已经完成的所有配置，然后重新尝试安装
{{% /alert %}}

### 如何使用自动部署脚本更新 Foundry VTT
Docker 容器为了保证运行时文件尽量不受改动，避免在不同时间启动容器产生了行为上的差异，使用了 `--noUpdate` 参数启动容器内的 FVTT，关闭了 Foundry VTT 自动更新的功能，导致无法使用 FVTT 内置的检查更新来升级。

为了解决这个问题，自动部署脚本包含了如何升级容器内 FVTT 版本的方法，这个方法会保证数据文件夹内的文件不受改动，可以放心升级，*但 FVTT 升级后再启动世界往往会对世界进行更新*。

**该方法不仅可以升级版本，还可以方便地用脚本重装同版本或者回退版本。**

升级方法：
1. 假设已经登入了 Linux 服务器，首先移除旧有容器
    ```bash
    sudo ./fvtt.sh remove
    ```
    按提示，输入 `y` 后回车确认，等待几秒后，旧版本容器即被成功删除

2. 重建容器，使用新版本
    ```bash
    sudo ./fvtt.sh recreate
    ```
    进入和安装流程非常类似的重建容器流程，默认使用已存储的配置文件

    版本号或者下载地址，输入你想升级/回退的版本号或者对应下载地址即可

{{% alert title="提示" color="info" %}}
为了方便升级和二次部署，脚本运行后默认会存储输入的参数信息。如果不需要存储配置，避免服务器被黑之后信息泄露，请在脚本运行完毕后删除 `fvtt-config` 文件
{{% /alert %}}

### 部署教程视频

{{< bilibili BV1Bv41167n6 >}}
